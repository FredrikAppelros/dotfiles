#!/bin/sh

export DOTFILESDIR="$(readlink -e $(dirname $0))"

run_scripts () {
  for file in $(find $DOTFILESDIR -name $1 | xargs); do
    sh -c "$file"
  done
}

# Run preinstall scripts
run_scripts preinstall.sh

# Install packages
sudo apt-get update && sudo apt-get install -y $(cat packages | xargs)

# Initialize submodules
git submodule update --init --recursive

# Run install scripts
run_scripts install.sh

# Run postinstall scripts
run_scripts postinstall.sh

# Create symbolic links
ln -s "$DOTFILESDIR/bin" "$HOME/bin"
for target in $(find "$DOTFILESDIR" -name "*.symlink"); do
  link="$HOME/.$(basename ${target%.*})"
  ln -s "$target" "$link"
done
